name: example-command
on:
  repository_dispatch:
    types: [example-command]

jobs:
  example:
    runs-on: ubuntu-latest
    steps:
      # ‚úÖ React ‡∏ó‡∏µ‡πà comment ‡πÄ‡∏î‡∏¥‡∏°
      - name: Add reaction
        uses: peter-evans/create-or-update-comment@v4
        with:
          token: ${{ secrets.PAT }}
          repository: ${{ github.event.client_payload.github.payload.repository.full_name }}
          comment-id: ${{ github.event.client_payload.github.payload.comment.id }}
          reactions: hooray

      # ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á comment ‡πÉ‡∏´‡∏°‡πà (‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤ Jenkins rebuild)
      - name: Create new comment
        uses: peter-evans/create-or-update-comment@v4
        with:
          token: ${{ secrets.PAT }}
          repository: ${{ github.event.client_payload.github.payload.repository.full_name }}
          issue-number: ${{ github.event.client_payload.github.payload.issue.number }}
          body: |
            üöÄ Jenkins rebuild triggered!
            - PR: #${{ github.event.client_payload.github.payload.issue.number }}
            - By: @${{ github.event.client_payload.github.actor.login }}
            - PR URL: ${{ github.event.client_payload.github.payload.issue.pull_request.url }}

      # ‚úÖ Comment ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà Jenkins ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (genericVariables)
      - name: Get PR Info
        id: prinfo
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.PAT }}
          script: |
            const prNumber = context.payload.client_payload.github.payload.issue.number;
            const { data: pr } = await github.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: prNumber
            });
            core.setOutput("head_ref", pr.head.ref);
            core.setOutput("base_ref", pr.base.ref);
            core.setOutput("title", pr.title);
            core.setOutput("html_url", pr.html_url);

      - name: Post Jenkins Variables
        uses: peter-evans/create-or-update-comment@v4
        with:
          token: ${{ secrets.PAT }}
          repository: ${{ github.repository }}
          issue-number: ${{ github.event.client_payload.github.payload.issue.number }}
          body: |
            {
              "action": "reopened",
              "number": ${{ github.event.client_payload.github.payload.issue.number }},
              "pull_request": {
                "title": "${{ steps.prinfo.outputs.title }}",
                "html_url": "${{ steps.prinfo.outputs.html_url }}",
                "head": {
                  "ref": "${{ steps.prinfo.outputs.head_ref }}",
                  "repo": {
                    "name": "${{ github.event.client_payload.github.payload.repository.name }}",
                    "clone_url": "${{ github.event.client_payload.github.payload.repository.clone_url }}"
                  }
                },
                "base": {
                  "ref": "${{ steps.prinfo.outputs.base_ref }}"
                }
              },
              "repository": {
                "full_name": "${{ github.event.client_payload.github.payload.repository.full_name }}"
              }
            }
